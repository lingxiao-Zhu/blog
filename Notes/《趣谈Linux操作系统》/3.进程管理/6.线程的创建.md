# 进程的创建

通过 fork 创建进程。

fork 是一个系统调用，相应的系统调用 sys_fork。

它包含两个重要的事件，一个是将 task_struct 结构复制一份并且初始化，另一个是试图唤醒新创建的子进程。

## fork 的第一件大事：复制结构

- 创建 task_struct。
- 创建内核栈，分配连续地址的内存空间。
- 复制父进程的结构到 task_struct。
- 设置权限，和父进程一致。
- 分配 pid，设置 tid，group_leader，并且建立进程之间的亲缘关系。

## fork 的第二件大事：唤醒新进程

新任务刚刚建立，有没有机会抢占别人，获得 CPU 呢？

如果新创建的进程应该抢占父进程，在什么时间抢占呢？别忘了 fork 是一个系统调用，从系统调用返回的时候，是抢占的一个好时机，如果父进程判断自己已经被设置为 TIF_NEED_RESCHED，就让子进程先跑，抢占自己
