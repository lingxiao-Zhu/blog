# 线程

使用进程实现并行执行的问题也有两个。第一，创建进程占用资源太多；第二，进程之间的通信需要数据在不同的内存空间传来传去，无法共享。

## 为什么要有线程？

进程也是默认有一个主线程的。

线程负责执行指令，进程要比线程管的宽多了，除了执行指令之外，内存、文件系统等等都要它来管。

> 进程相当于一个项目，而线程就是为了完成项目需求，而建立的一个个开发任务.。

## 线程的数据

线程可以将项目并行起来，加快进度，但是也带来的负面影响，过程并行起来了，那数据呢？

第一类是线程栈上的本地数据，比如函数执行过程中的局部变量。主线程在内存中有一个栈空间，其他线程栈也拥有独立的栈空间。

第二类是整个进程里共享的全剧数据。如果同一个全局变量，两个线程一起修改，那肯定会有问题，需要保护数据。

第三类是线程私有数据，线程退出的时候释放。

## 数据的保护

接下来，我们来看共享的数据保护问题。

### Mutex 互斥

它的模式就是在共享数据访问的时候，去申请加把锁，谁先拿到锁，谁就拿到了访问权限，其他人就只好在门外等着，等这个人访问结束，把锁打开，其他人再去争夺，还是遵循谁先拿到谁访问。

- pthread_mutex_lock：去抢那把锁的函数，如果抢到了，就可以执行下一行程序，对共享变量进行访问；如果没抢到，就被阻塞在那里等待。
- pthread_mutex_trylock：如果没抢到，返回错误码。
- pthread_mutex_unlock：释放锁
- pthread_mutex_destory：销毁锁

### 条件变量

在使用 Mutex 的时候，有个问题是如果使用 pthread_mutex_lock()，那就需要一直在那里等着。

但是我怎么知道什么时候回来再试一下，是不是轮到我了呢？能不能在轮到我的时候，通知我一下呢？

主线程通过广播消息告知子线程。
